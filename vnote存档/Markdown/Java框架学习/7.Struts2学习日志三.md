# OGNL表达式与值栈  
## 一、OGNL表达式  
 OGNL 的全称是<font color=red>对象图导航语言 ( Object-Graph Navigation Language )</font>，它是一种功能强大的开源表达式语言，使用这种表达式语言，可以通过某种表达式语法，<font color=blue>存取Java对象的任意属性，调用Java对象的方法，同时能够自动实现必要的类型转换</font>。如果把表达式看作是一个带有语义的字符串，那么OGNL无疑成为了这个语义字符串与Java对象之间沟通的桥梁。  
### 1.1 OGNL三要素  
#### 1.1.1 表达式  
 表达式是<font color=blue>整个OGNL的核心</font>，OGNL会根据表达式去对象中取值。所有OGNL操作都是针对<font color=blue>表达式解析后进行的</font>。它表明了此次OGNL操作要"做什么"。表达式就是<font color=blue>一个带有语法含义的字符串</font>，这个字符串规定了操作的类型和操作的内容。OGNL支持大量的表达式语法，不仅支持这种“链式”对象访问路径，还支持在表达式中进行简单的计算。  
#### 1.1.2 根对象(Root)  
Root对象可以理解为<font color=blue>OGNL的操作对象</font>，表达式规定了“做什么”，而<font color=blue>Root对象则规定了“对谁操作”</font>。OGNL称为对象图导航语言，<font color=red>**所谓对象图，即以任意一个对象为根，通过OGNL可以访问与这个对象关联的其它对象。**</font>  
#### 1.1.3 Context对象  
实际上OGNL的取值还需要一个<font color=red>上下文环境</font>。设置了Root对象，OGNL可以对Root对象进行取值或写值等操作，<font color=red>Root对象所在环境就是OGNL的上下文环境(Context )</font>。上下文环境规定了OGNL的操作“在哪进行”。上下文环境Context是一个<font color=red>Map类型的对象</font>，在表达式中访问Context中的对象，需要<font color=red>使用“#”号加上对象名称</font>，即<font color=red>“#对象名称”</font>的形式。  
![](_v_images/20190606230014010_19647.png =451x)  
### 1.2 OGNL的使用  
struts2导入的相关包中已经包含了OGNL的包，不用格外导入。  
#### 1.2.1 OGNL环境准备  
![](_v_images/20190606230814738_25758.png =752x)  
#### 1.2.2 获取OGNL Root对象中的属性值  
![](_v_images/20190606232942880_687.png =779x)  
#### 1.2.3 获取Context对象中的Map集合的属性值  
![](_v_images/20190606233448155_22879.png =757x)  
#### 1.2.4 设置Root和Context对象中各属性的值  
![](_v_images/20190606234047412_23772.png =691x)
#### 1.2.5 利用OGNL表达式调用方法  
![](_v_images/20190606234836199_6043.png =772x)  
#### 1.2.6 利用OGNL表达式调用静态方法  
![](_v_images/20190606234652159_11562.png =837x)  
#### 1.2.7 利用OGNL表达式创建对象  
![](_v_images/20190606235320808_17192.png =771x)  
## 二、ognl表达式与struts2结合原理  
## 三、值栈概念和获取值栈  
![](_v_images/20190608000616755_16445.png =667x)  
## 四、值栈对象及其内部结构  
每次访问action时都会创建一个对象，每个action中只有一个值栈对象。  
![](_v_images/20190608000815350_4039.png =485x)  
![](_v_images/20190608002248242_567.png =885x)  
![](_v_images/20190608002218772_21494.png =606x)  
![](_v_images/20190608002645246_30126.png =652x)  
![](_v_images/20190608002717104_15337.png =642x)  
## 五、Action向值栈中存数据  
### 5.1 向值栈中放数据的三种方法  
#### 5.1.1 set方法  
![](_v_images/20190608003152668_1550.png =556x)  
#### 5.1.2 push方法  
![](_v_images/20190608003436685_29905.png =581x)  
前两种方法会压栈到root空间上，后一种会放到action的属性中。  
#### 5.1.3 定义变量并生成get方法即可  
![](_v_images/20190608004213492_5605.png =548x)  
![](_v_images/20190608004611886_11199.png =784x)  
### 5.2 存放字符串、对象和list集合  
见5.1.3节即可。  
## 六、结果页面(jsp页面)从值栈中取数据  
先在值栈中放数据呗。  
![](_v_images/20190608005044868_9107.png =488x)  
因为放的数据都作为action的添加属性，及其属性值存在，所以用OGNL表达式直接获取即可。  
### 6.1 取字符串  
先添加OGNL的标签啊。  
![](_v_images/20190608005250880_17833.png)  
![](_v_images/20190608005355021_12182.png =501x)  
### 6.2 取对象  
![](_v_images/20190608005749493_24748.png)  
### 6.3 取list集合  
![](_v_images/20190608005925378_8836.png =540x)  
![](_v_images/20190608010031310_14495.png =548x)  
![](_v_images/20190608010120335_4759.png =521x)
  
## 七、其它获取值栈数据的方法(针对set和push的方式)  
set和push把它放置于action之上，实时压栈。  
![](_v_images/20190608010943563_25155.png =471x)  
![](_v_images/20190608011204290_824.png =569x)  
## 八、#在值栈中的应用  
当然是获取ActionContext中的数据了，它是一个map集合，参考OGNL的使用就知道其用法了。  
值栈中存了很多域对象，只要在我们获得了某个域对象，并设置了什么参数，就可以用OGNL表达式在页面中获取。  
比如我们粗鄙的获取原生request对象后设置值如下：  
![](_v_images/20190608011928041_13918.png =563x)  
那么就可以在结果页面中获得：  
![](_v_images/20190608012116956_18699.png =551x)  
  
<font color=red size=4>值栈是用来放数据的，替代域对象。</font>  
  
<font color=red size=4>所以获取原生域对象是不齿的，struts2建议不放在Servlet域对象中，而只推荐放在值栈的root中。</font>  
  